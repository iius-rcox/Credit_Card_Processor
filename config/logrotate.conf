# Logrotate configuration for Credit Card Processor
# This file should be placed in /etc/logrotate.d/ on the production server
# Usage: sudo cp config/logrotate.conf /etc/logrotate.d/credit-card-processor

# Application logs
/var/log/credit-card-processor/application.log
/var/log/credit-card-processor/errors.log
/var/log/credit-card-processor/security.log
/var/log/credit-card-processor/performance.log
/var/log/credit-card-processor/application-daily.log {
    daily
    missingok
    rotate 30
    compress
    delaycompress
    notifempty
    sharedscripts
    postrotate
        # Signal the application to reopen log files
        docker exec credit-card-backend-prod kill -USR1 1 2>/dev/null || true
    endscript
}

# nginx access logs
/var/log/nginx/credit-card-access.log {
    daily
    missingok
    rotate 52
    compress
    delaycompress
    notifempty
    create 644 nginx nginx
    sharedscripts
    postrotate
        if [ -f /var/run/nginx.pid ]; then
            kill -USR1 $(cat /var/run/nginx.pid)
        fi
    endscript
}

# nginx error logs
/var/log/nginx/credit-card-error.log {
    daily
    missingok
    rotate 52
    compress
    delaycompress
    notifempty
    create 644 nginx nginx
    sharedscripts
    postrotate
        if [ -f /var/run/nginx.pid ]; then
            kill -USR1 $(cat /var/run/nginx.pid)
        fi
    endscript
}

# Database logs (if applicable)
/var/log/credit-card-processor/database.log {
    weekly
    missingok
    rotate 12
    compress
    delaycompress
    notifempty
}

# Audit logs (high retention)
/var/log/credit-card-processor/audit.log {
    daily
    missingok
    rotate 365
    compress
    delaycompress
    notifempty
    # Don't delete audit logs automatically - archive them
    # maxage 2555  # 7 years retention for compliance
}